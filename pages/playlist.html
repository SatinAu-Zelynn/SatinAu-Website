<!--
  Copyright 2025 缎金SatinAu

  Licensed under the Apache License, Version 2.0 (the "License");
  you may not use this file except in compliance with the License.
  You may obtain a copy of the License at

      http://www.apache.org/licenses/LICENSE-2.0

  Unless required by applicable law or agreed to in writing, software
  distributed under the License is distributed on an "AS IS" BASIS,
  WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
  See the License for the specific language governing permissions and
  limitations under the License.
-->

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>歌单分享 - 缎金SatinAu</title>
  <meta name="description" content="缎金SatinAu的音乐歌单">
  <meta name="keywords" content="缎金,SatinAu,歌单,音乐,Spotify,Bilibili,播放列表">
  <meta name="author" content="缎金SatinAu">
  <meta name="color-scheme" content="light dark">
  <meta name="supported-color-schemes" content="light dark">
  <link rel="canonical" href="https://satinau.cn/pages/playlist">
  <link rel="icon" type="image/x-icon" href="/public/favicon.ico">
  <link rel="stylesheet" href="/src/style.css">
  <link rel="preload" href="https://font.sec.miui.com/font/css?family=MiSans:200,300,400,450,500,600,650,700:Chinese_Simplify,Latin&display=swap" as="style" onload='this.onload=null,this.rel="stylesheet"'>
  <script src="/src/script/config.js"></script>
  <script src="/src/script/common.js" defer></script>
  <script src="/src/script/components/comment.js" defer></script>
  <script src="/src/script/components/CRCMenu.js"></script>
  <script src="/src/script/components/GlobalModal.js" defer></script>
  
  <style>
    /* 1. 网格容器：模仿 content-grid 的响应式布局 */
    .video-grid {
      display: grid;
      gap: 24px; /* 视频间距稍微大一点 */
      margin-top: 30px;
      /* 自动填充，最小宽度300px，确保移动端显示正常 */
      grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
      width: 100%;
      box-sizing: border-box;
    }

    /* 2. 单个视频的外层容器：负责 16:9 比例和外观风格 */
    .video-wrapper {
      position: relative;
      width: 100%;
      /* 16:9 宽高比黑魔法：高度设为0，通过 padding-bottom 撑开 */
      padding-bottom: 56.25%; 
      height: 0;
      
      /* 继承站点的玻璃质感风格 */
      border-radius: var(--border-radius-lg);
      background: light-dark(rgba(255, 255, 255, 0.28), rgba(30, 30, 30, 0.3));
      backdrop-filter: blur(24px) saturate(180%);
      -webkit-backdrop-filter: blur(24px) saturate(180%);
      border: 1px solid light-dark(rgba(255, 255, 255, 0.25), rgba(255,255,255,0.12));
      box-shadow: 0 12px 32px rgba(0,0,0,0.12);
      
      overflow: hidden; /* 必须有，否则 iframe 直角会遮住圆角 */
      transition: transform 0.3s ease, box-shadow 0.3s ease;
    }

    /* 悬停效果：轻微上浮 */
    .video-wrapper:hover {
      transform: translateY(-5px);
      box-shadow: 0 18px 40px rgba(0,0,0,0.2);
    }

    /* 3. iframe 绝对定位填满容器 */
    .video-wrapper iframe {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      border: none;
      /* iframe 淡入动画 */
      animation: fadeIn 0.5s ease forwards;
    }

    @keyframes fadeIn {
      from { opacity: 0; }
      to { opacity: 1; }
    }

    /* Spotify 容器样式 */
    .spotify-container {
      width: 100%;
      margin: 0 auto;
      border-radius: 12px;
      overflow: hidden;
      box-shadow: 0 12px 32px rgba(0, 0, 0, 0.15);
      transition: transform 0.3s ease;
      /* 给 Spotify 也加个底色防止加载慢时透明 */
      background: light-dark(rgba(255, 255, 255, 0.5), rgba(0,0,0,0.3));
    }
    .spotify-container:hover {
      transform: scale(1.01);
    }

    /* === 视频遮罩层样式 === */
    .video-mask {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      display: flex;
      flex-direction: column;
      justify-content: center;
      align-items: center;
      cursor: var(--custom-cursor, pointer);
      z-index: 10;
      background: light-dark(rgba(255,255,255,0.1), rgba(0,0,0,0.2));
      transition: background 0.3s ease;
      text-align: center;
      padding: 20px;
      box-sizing: border-box;
    }

    .video-mask:hover {
      background: light-dark(rgba(255,255,255,0.3), rgba(0,0,0,0.4));
    }

    /* 播放按钮图标 */
    .play-icon {
      width: 48px;
      height: 48px;
      fill: var(--primary-color);
      margin-bottom: 16px;
      opacity: 0.85;
      filter: drop-shadow(0 4px 6px rgba(0,0,0,0.2));
      transition: transform 0.3s cubic-bezier(0.34, 1.56, 0.64, 1), opacity 0.3s ease;
    }

    .video-mask:hover .play-icon {
      transform: scale(1.15);
      opacity: 1;
    }

    /* 视频标题 */
    .video-title {
      font-size: 16px;
      font-weight: 600;
      color: var(--word-color);
      line-height: 1.5;
      max-width: 90%;
      
      /* 多行省略 */
      display: -webkit-box;
      -webkit-line-clamp: 2;
      line-clamp: 2;
      -webkit-box-orient: vertical;
      overflow: hidden;
      text-overflow: ellipsis;
      
      text-shadow: 0 2px 10px rgba(0,0,0,0.1);
      transition: color 0.3s ease;
    }
    
    /* 移动端标题稍微小一点 */
    @media (max-width: 768px) {
        .video-title {
            font-size: 14px;
        }
        .play-icon {
            width: 40px;
            height: 40px;
        }
    }
  </style>

  <script type="text/javascript">
      (function(c,l,a,r,i,t,y){
          c[a]=c[a]||function(){(c[a].q=c[a].q||[]).push(arguments)};
          t=l.createElement(r);t.async=1;t.src="https://www.clarity.ms/tag/"+i;
          y=l.getElementsByTagName(r)[0];y.parentNode.insertBefore(t,y);
      })(window, document, "clarity", "script", "trwlkhxzch");
  </script>
</head>
<body id="playlist-page">
  <div class="color-bg color-bg-1"></div>
  <div class="color-bg color-bg-2"></div>
  <div class="color-bg color-bg-3"></div>
  <div class="color-bg color-bg-4"></div>

  <main class="page">
    <header>
      <div class="title-row">
        <h1>歌单分享</h1>
      </div>
      <div class="greeting" id="greeting"></div>
    </header>

    <section>
      <h2>Spotify</h2>
      <p>国内大概率访问不上</p>
      <div class="spotify-container">
        <iframe 
          style="border-radius:12px" 
          src="https://open.spotify.com/embed/playlist/0W3c4YHSKyx9b4IEx0mdjE?utm_source=generator" 
          width="100%" 
          height="352" 
          frameBorder="0" 
          allowfullscreen="" 
          allow="autoplay; clipboard-write; encrypted-media; fullscreen; picture-in-picture" 
          loading="lazy"
          title="Spotify Playlist"
        ></iframe>
      </div>
    </section>

    <section>
      <h2>哔哩哔哩 / Bilibili</h2>
      <div id="bilibili-list" class="video-grid">
        <p style="grid-column: 1/-1; opacity: 0.6;">正在加载视频列表...</p>
      </div>
    </section>

    <section style="text-align: left;">
      <div id="playlist-comments"></div>
    </section>

    <script src="/src/script/components/footer.js"></script>
    <site-footer></site-footer>
  </main>

  <!-- 加载动画 -->
  <div id="loadingOverlay" class="loading-overlay">
    <div class="spinner"></div>
  </div>

  <!-- Toast -->
  <div id="toast" class="toast"></div>

  <!-- 导航栏 -->
  <script src="/src/script/components/navigate.js"></script>
  <navigate-bar></navigate-bar>

  <script>
    document.addEventListener('DOMContentLoaded', function() {
      initPageComments('playlist-comments', 'playlist');
      const container = document.getElementById('bilibili-list');
      const jsonUrl = 'https://blog.satinau.cn/data/playlist.json'; 

      fetch(jsonUrl)
        .then(response => {
          if (!response.ok) throw new Error('Network response was not ok');
          return response.json();
        })
        .then(data => {
          container.innerHTML = ''; // 清空加载提示

          if (!data || data.length === 0) {
            container.innerHTML = '<p style="grid-column: 1/-1; text-align:center;">暂无视频</p>';
            return;
          }

          data.forEach(item => {
            // 1. 创建外层容器 (video-wrapper)
            const wrapper = document.createElement('div');
            wrapper.className = 'video-wrapper';
            
            // 2. 创建遮罩层 (Video Mask/Card) - 初始显示这个，不加载iframe
            const mask = document.createElement('div');
            mask.className = 'video-mask';
            // 使用 SVG 绘制播放按钮 + JSON中的标题
            mask.innerHTML = `
              <svg class="play-icon" viewBox="0 0 24 24">
                <path d="M8 5v14l11-7z"/>
              </svg>
              <div class="video-title">${item.title || '哔哩哔哩视频'}</div>
            `;

            // 3. 点击事件：点击遮罩后才加载 iframe
            mask.addEventListener('click', function() {
                // 清空 wrapper (移除 mask)
                wrapper.innerHTML = '';

                // 创建 iframe
                const iframe = document.createElement('iframe');
                // 注意：这里将 autoplay 设置为 1，因为是用户主动点击播放
                iframe.src = `//player.bilibili.com/player.html?isOutside=true&aid=${item.aid}&bvid=${item.bvid}&cid=${item.cid}&p=1&autoplay=1&high_quality=1`;
                iframe.scrolling = "no";
                iframe.border = "0";
                iframe.frameBorder = "0";
                iframe.setAttribute('framespacing', '0');
                iframe.allowFullscreen = true;
                iframe.sandbox = "allow-top-navigation allow-same-origin allow-forms allow-scripts";
                iframe.title = item.title || 'Bilibili Video';
                
                // 放入容器
                wrapper.appendChild(iframe);
            });

            // 4. 组装：初始只放入遮罩
            wrapper.appendChild(mask);
            container.appendChild(wrapper);
          });
        })
        .catch(error => {
          console.error('Fetch playlist error:', error);
          container.innerHTML = '<p style="grid-column: 1/-1; text-align:center; color: var(--word-color);">加载歌单失败</p>';
        });
    });
  </script>
  
  <!-- 弹窗组件 -->
  <global-modal id="globalModal"></global-modal>

</body>
</html>